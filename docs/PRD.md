# π“ PRD (Product Requirements Document)

## 1. κ°μ” (Introduction)

λ³Έ ν”„λ΅μ νΈλ” Eclipse hawkBitμ **DDI(Direct Device Integration) API**λ¥Ό λ¨λ°©ν• μ„λ²„-ν΄λΌμ΄μ–ΈνΈ ν†µμ‹  μμ  κ°λ°μ„ μ„ν• **μ ν’ μ”κµ¬μ‚¬ν•­ λ¬Έμ„**μ…λ‹λ‹¤. μ΄ μμ λ” μ‹¤μ  hawkBit μ‹μ¤ν…μ λ¨λ“  κΈ°λ¥μ„ κµ¬ν„ν•κΈ°λ³΄λ‹¤, κΈ°κΈ°κ°€ μ„λ²„μ— μƒνƒλ¥Ό λ³΄κ³ ν•κ³  μ—…λ°μ΄νΈ μ‘μ—…μ„ ν΄λ§ν•λ” κΈ°λ³Έμ μΈ ν†µμ‹  νλ¦„μ„ μ΄ν•΄ν•λ” λ° μ¤‘μ μ„ λ‘΅λ‹λ‹¤.

νΉν, μ‹¤μ  νμΌ μ „μ†΅ μ‹λ‚λ¦¬μ¤λ¥Ό μ‹λ®¬λ μ΄μ…ν•κΈ° μ„ν•΄ **1MB ν¬κΈ°μ λ”λ―Έ νμΌ**μ„ μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•λ” κΈ°λ¥μ„ ν¬ν•¨ν•©λ‹λ‹¤.

* **μ„λ²„**: **Python FastAPI**λ¥Ό μ‚¬μ©ν•λ©°, ν”„λ΅μ νΈ κ΄€λ¦¬λ” **`pyproject.toml`** νμΌ, μ‹¤ν–‰μ€ **UVicorn**μΌλ΅ ν•©λ‹λ‹¤.
* **ν΄λΌμ΄μ–ΈνΈ**: **C++**λ΅ κ°λ°λλ©°, λΉλ“λ” **CMake**μ™€ **`build.sh`** μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

-----

## 2. κΈ°λ¥ μ”κµ¬μ‚¬ν•­ (Functional Requirements)

### 2.1 μ„λ²„ (FastAPI)

* **κΈ°κΈ° μƒνƒ ν΄λ§ (Polling)**: ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° νΉμ • `controllerId`λ¥Ό ν¬ν•¨ν• **GET** μ”μ²­μ„ λ°›μµλ‹λ‹¤.
* **μ—…λ°μ΄νΈ μ‘μ—… μ κ³µ**: ν΄λ§ μ”μ²­μ— μ‘λ‹µν•μ—¬ 1MB λ”λ―Έ νμΌ λ‹¤μ΄λ΅λ“ URLμ΄ ν¬ν•¨λ **JSON** ν•μ‹μ μ—…λ°μ΄νΈ μ •λ³΄λ¥Ό λ°ν™ν•©λ‹λ‹¤.
* **νμΌ μ—”λ“ν¬μΈνΈ μ¶”κ°€**: `/files/firmware.bin` μ—”λ“ν¬μΈνΈμ— λ€ν• **GET** μ”μ²­μ„ μ²λ¦¬ν•μ—¬ λ―Έλ¦¬ μƒμ„±ν•΄ λ‘” 1MB λ”λ―Έ νμΌμ„ μ „μ†΅ν•©λ‹λ‹¤.
* **μƒνƒ λ³΄κ³  (Reporting)**: ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ—…λ°μ΄νΈ μ‘μ—…μ μ§„ν–‰ μƒνƒλ¥Ό λ³΄κ³ λ°›λ” **POST** μ”μ²­μ„ μ²λ¦¬ν•©λ‹λ‹¤.

### 2.2 ν΄λΌμ΄μ–ΈνΈ (C++)

* **μ„λ²„ ν΄λ§**: νΉμ • `controllerId`λ¥Ό μ‚¬μ©ν•μ—¬ μ„λ²„μ— μ£ΌκΈ°μ μΌλ΅ **GET** μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.
* **νμΌ λ‹¤μ΄λ΅λ“**: μ„λ²„μ μ‘λ‹µ JSONμ—μ„ λ‹¤μ΄λ΅λ“ URLμ„ μ¶”μ¶ν•μ—¬, ν•΄λ‹Ή URLλ΅ **GET** μ”μ²­μ„ λ³΄λ‚΄ 1MB λ”λ―Έ νμΌμ„ λ‹¤μ΄λ΅λ“ν•κ³  λ΅μ»¬μ— μ €μ¥ν•©λ‹λ‹¤.
* **μ—…λ°μ΄νΈ μ‘μ—… μ‹λ®¬λ μ΄μ…**: μ‹¤μ  νμ›¨μ–΄ λ‹¤μ΄λ΅λ“ λ° μ„¤μΉ κ³Όμ •μ„ μ‹λ®¬λ μ΄μ…ν•κ³ , κ·Έ κ²°κ³Όλ¥Ό μ„λ²„μ— λ³΄κ³ ν•©λ‹λ‹¤.
* **μƒνƒ λ³΄κ³ **: νμΌ λ‹¤μ΄λ΅λ“ μ„±κ³µ/μ‹¤ν¨ μ—¬λ¶€λ¥Ό **POST** μ”μ²­μΌλ΅ μ„λ²„μ— μ „λ‹¬ν•©λ‹λ‹¤.

-----

## 3. κΈ°μ  μ”κµ¬μ‚¬ν•­ (Technical Requirements)

### 3.1 μ„λ²„

* **μ–Έμ–΄**: Python
* **ν”„λ μ„μ›ν¬**: FastAPI
* **ν¨ν‚¤μ§€ κ΄€λ¦¬**: `uv`λ¥Ό μ‚¬μ©ν•λ©°, μμ΅΄μ„±μ€ **`pyproject.toml`** νμΌμ— λ…μ‹ν•©λ‹λ‹¤.
  ```toml
  [project]
  name = "hawkbit-server"
  version = "0.1.0"
  dependencies = [
      "fastapi",
      "uvicorn",
      "uv"
  ]
  ```
* **μ‹¤ν–‰ λ°©μ‹**: `uv run uvicorn main:app --reload` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.
* **νμΌ μ „μ†΅**: FastAPIμ `FileResponse` λλ” `StreamingResponse`λ¥Ό ν™μ©ν•μ—¬ 1MB λ”λ―Έ νμΌμ„ ν¨μ¨μ μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤.

### 3.2 ν΄λΌμ΄μ–ΈνΈ

* **μ–Έμ–΄**: C++11 μ΄μƒ
* **λΉλ“ μ‹μ¤ν…**: **CMake**
* **λΉλ“ μ¤ν¬λ¦½νΈ**: **`build.sh`** νμΌμ„ μ κ³µν•μ—¬ λΉλ“ κ³Όμ •μ„ μλ™ν™”ν•©λ‹λ‹¤.
  ```bash
  #!/bin/bash

  rm -rf build
  mkdir build
  cd build
  cmake ..
  make
  cd ..

  echo "Client build completed. Executable is at build/client"
  ```
* **HTTP λΌμ΄λΈλ¬λ¦¬**: **cURL** λλ” **cpp-httplib** μ‚¬μ©μ„ κ¶μ¥ν•©λ‹λ‹¤.

-----

## 4. ν†µμ‹  ν”„λ΅ν† μ½ (Communication Protocol)

λ³Έ ν”„λ΅μ νΈλ” hawkBit DDI APIμ ν•µμ‹¬μ μΈ λ™μ‘ λ°©μ‹μ„ λ¨λ°©ν•©λ‹λ‹¤.

* **ν΄λ§**: ν΄λΌμ΄μ–ΈνΈκ°€ `GET /rest/v1/ddi/v1/controller/device/{controllerId}`λ¥Ό ν†µν•΄ μ—…λ°μ΄νΈ μ”μ²­.
* **μ—…λ°μ΄νΈ μ •λ³΄**: μ„λ²„κ°€ JSON ν•μ‹μΌλ΅ μ‘λ‹µν•λ©°, λ‹¤μ΄λ΅λ“ν•  νμΌμ `href`μ™€ `size` μ •λ³΄λ¥Ό ν¬ν•¨.
  ```json
  {
    "deploymentBase": {
      "id": "12345",
      "download": {
        "links": {
          "firmware": {
            "href": "http://<μ„λ²„μ£Όμ†>/files/firmware.bin",
            "size": 1048576
          }
        }
      }
    }
  }
  ```
* **μƒνƒ λ³΄κ³ **: ν΄λΌμ΄μ–ΈνΈκ°€ `POST /rest/v1/ddi/v1/controller/device/{controllerId}/deploymentBase/{id}`λ΅ μ‘μ—… μƒνƒ(μ: `SUCCESS`, `FAILURE`)λ¥Ό λ³΄κ³ .